---
import Base from "../../layouts/Base.astro";
import { loadCategories, loadMeta, formatCategoryName } from "../../lib/generated";

const categories = await loadCategories();
const meta = await loadMeta();

// Sort categories: most indexable first, filter out empty ones
const sortedCategories = [...categories]
  .filter((c) => c.indexable > 0)
  .sort((a, b) => b.indexable - a.indexable);

const canonical = "https://freeperlcode.com/topics";
---

<Base
  title="Perl Topics - Browse Questions by Category"
  description="Browse Perl programming topics including regex, file handling, data structures, CPAN modules, and more. Find answers organized by category."
  canonical={canonical}
>
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold mb-2">Perl Topics</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-4">
      Explore our comprehensive Perl knowledge base organized by topic. Each topic contains
      verified questions with runnable code examples.
    </p>

    {meta && (
      <div class="mb-8 p-4 rounded-xl bg-perl-50 dark:bg-dark-800 border border-perl-200 dark:border-dark-700">
        <div class="grid grid-cols-3 gap-4 text-center">
          <div>
            <div class="text-2xl font-bold text-perl-500">{meta.indexable_questions}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Published</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-perl-500">{meta.verified_questions}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Verified</div>
          </div>
          <div>
            <div class="text-2xl font-bold text-perl-500">{meta.total_questions}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">Total</div>
          </div>
        </div>
      </div>
    )}

    {sortedCategories.length === 0 ? (
      <div class="p-6 rounded-xl border border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800">
        <p class="text-gray-700 dark:text-gray-300">
          No categories exported yet. Run the data pipeline with <code class="bg-gray-200 dark:bg-dark-700 px-2 py-1 rounded">make export</code> first.
        </p>
      </div>
    ) : (
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {sortedCategories.map((c) => (
          <a
            href={`/topics/${c.slug}`}
            class="group p-5 rounded-xl border border-gray-200 dark:border-dark-700 hover:border-perl-500 dark:hover:border-perl-500 transition-colors bg-white dark:bg-dark-900"
          >
            <div class="font-semibold mb-2 group-hover:text-perl-500 transition-colors">
              {formatCategoryName(c.slug)}
            </div>
            <div class="text-sm text-gray-600 dark:text-gray-400">
              {c.indexable} questions
            </div>
          </a>
        ))}
      </div>
    )}

    <div class="mt-12 p-6 rounded-xl bg-gray-50 dark:bg-dark-800 border border-gray-200 dark:border-dark-700">
      <h2 class="text-xl font-bold mb-3">What You'll Find</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        Every question includes verified, runnable code with actual output:
      </p>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div>
          <h3 class="font-semibold text-perl-500 mb-2">Core Topics</h3>
          <ul class="space-y-1 text-gray-600 dark:text-gray-400">
            <li>Regular expressions and pattern matching</li>
            <li>File I/O and directory operations</li>
            <li>Arrays, hashes, and data structures</li>
            <li>Text processing and one-liners</li>
            <li>Variables, scalars, and references</li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold text-perl-500 mb-2">Practical Skills</h3>
          <ul class="space-y-1 text-gray-600 dark:text-gray-400">
            <li>Object-oriented Perl (Moose, Moo)</li>
            <li>Database access with DBI</li>
            <li>HTTP requests and web scraping</li>
            <li>CPAN modules and installation</li>
            <li>System administration scripts</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="mt-8">
      <h2 class="text-xl font-bold mb-4">Can't Find What You're Looking For?</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        Use our AI-powered search to find specific answers or ask our chat assistant for
        personalized help with your Perl questions.
      </p>
      <div class="flex gap-4">
        <a
          href="/search"
          class="inline-flex items-center px-4 py-2 bg-perl-500 text-white rounded-lg hover:bg-perl-600 transition-colors"
        >
          Search
        </a>
        <button
          data-open-chat="true"
          class="inline-flex items-center px-4 py-2 border border-perl-500 text-perl-500 rounded-lg hover:bg-perl-50 dark:hover:bg-dark-800 transition-colors"
        >
          Ask AI
        </button>
      </div>
    </div>
  </section>
</Base>
