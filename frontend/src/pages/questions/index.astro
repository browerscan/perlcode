---
import Base from "@layouts/Base.astro";
import { isIndexableQuestion, loadQuestions } from "@/lib/generated";

const questions = await loadQuestions();
const indexable = questions.filter(isIndexableQuestion);
const latest = indexable.slice(0, 200);
---

<Base title="Questions" description="Browse verified Perl questions and answers.">
  <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold mb-2">Questions</h1>
    <p class="text-gray-600 dark:text-gray-400 mb-8">
      Showing {latest.length} of {indexable.length} published & verified pages.
    </p>

    {indexable.length === 0 ? (
      <div class="p-6 rounded-xl border border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800">
        <p class="text-gray-700 dark:text-gray-300">
          No verified pages are published yet. Run the pipeline and publish a small batch, then rebuild.
        </p>
        <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
          Tip: `make generate` → `make publish` → `make export` → `make build`
        </div>
      </div>
    ) : (
      <ul class="space-y-3">
        {latest.map((q) => (
          <li>
            <a
              href={`/questions/${q.slug}`}
              class="block p-4 rounded-lg border border-gray-200 dark:border-dark-700 hover:border-perl-500 dark:hover:border-perl-500 transition-colors"
            >
              <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">
                {q.category} • {q.difficulty}
              </div>
              <div class="font-medium">{q.title}</div>
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Base>

